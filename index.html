<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Master AI - Smart Practice</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@300;400;600&display=swap');

        :root {
            --primary: #2563EB;
            --primary-dark: #1E40AF;
            --secondary: #F3F4F6;
            --accent: #10B981;
            --danger: #EF4444;
            --text-dark: #1F2937;
            --white: #ffffff;
        }

        body { font-family: 'Poppins', sans-serif; background-color: #EEF2FF; color: var(--text-dark); margin: 0; padding: 20px; display: flex; flex-direction: column; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: var(--white); border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden; width: 100%; }
        
        header { background: var(--primary); color: var(--white); padding: 20px; text-align: center; }
        header h1 { margin: 0; font-size: 1.8rem; }
        
        .search-bar-container { padding: 15px; background: #DBEAFE; display: flex; gap: 10px; justify-content: center; align-items: center; border-bottom: 1px solid #bfdbfe; }
        .search-input { padding: 10px 15px; border-radius: 25px; border: 1px solid #fff; width: 100%; max-width: 300px; outline: none; }
        .search-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .search-btn:hover { background: var(--primary-dark); }

        .controls { padding: 20px; border-bottom: 1px solid #eee; display: block; }
        .controls.hidden { display: none; }
        .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 150px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        select { width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; }
        
        .sub-cats-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; max-height: 200px; overflow-y: auto; }
        .cat-checkbox { display: none; }
        .cat-label { 
            display: flex; justify-content: center; align-items: center;
            width: 45px; height: 45px;
            background: var(--secondary); border-radius: 8px; 
            cursor: pointer; font-size: 1rem; font-weight: 600;
            border: 2px solid transparent; transition: all 0.2s;
        }
        .cat-checkbox:checked + .cat-label { background: #DBEAFE; border-color: var(--primary); color: var(--primary-dark); transform: scale(1.05); }

        button.main-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: 600; cursor: pointer; margin-top: 10px; }
        button.main-btn:disabled { background: #9CA3AF; cursor: wait; }

        #practice-area { padding: 20px; display: none; flex-direction: column; align-items: center; min-height: 400px; }
        
        .progress-container { width: 100%; max-width: 600px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .progress-track { flex: 1; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s ease; }
        .progress-text { font-size: 0.9rem; font-weight: 600; color: #666; width: 80px; text-align: right; }

        .card { width: 100%; max-width: 600px; background: var(--white); border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; position: relative; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .arabic-phrase { font-family: 'Cairo', sans-serif; font-size: 1.4rem; color: var(--text-dark); margin: 15px 0; padding: 10px; background: #f9fafb; border-right: 4px solid var(--primary); border-radius: 8px; text-align: right; line-height: 1.6; }
        
        .input-area { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        /* Nouveau wrapper pour inclure le micro dans l'input */
        .input-wrapper { position: relative; width: 100%; }
        
        .translation-input { padding: 12px; padding-right: 40px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1.1rem; width: 100%; box-sizing: border-box; }
        
        /* Style du bouton micro */
        .mic-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #9CA3AF;
            transition: color 0.2s;
        }
        .mic-btn:hover { color: var(--primary); }
        .mic-btn.listening { color: var(--danger); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .action-btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; transition: 0.2s; }
        .check-btn { background: var(--primary); color: white; }
        .check-btn:hover { background: var(--primary-dark); }

        .eval-buttons { display: none; gap: 10px; margin-top: 15px; }
        .btn-correct { background: var(--accent); color: white; flex: 1; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-correct:hover { background: #059669; }
        .btn-incorrect { background: var(--danger); color: white; flex: 1; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-incorrect:hover { background: #DC2626; }

        .feedback-box { margin-top: 15px; padding: 15px; border-radius: 8px; display: none; text-align: left; font-size: 0.95rem; }
        .feedback-box.success { background: #D1FAE5; color: #065F46; border: 1px solid #34D399; }
        .feedback-box.error { background: #FEE2E2; color: #991B1B; border: 1px solid #F87171; }

        .word-bank-container { margin-top: auto; background: #f8fafc; padding: 20px; border-top: 1px solid #e2e8f0; }
        .word-bank-title { font-size: 0.9rem; font-weight: 600; color: #64748b; margin-bottom: 10px; }
        .word-chips { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
        .word-chip { font-size: 0.8rem; padding: 4px 10px; background: white; border: 1px solid #cbd5e1; border-radius: 15px; cursor: pointer; transition: all 0.2s; color: #475569; }
        .word-chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        .word-chip.completed { background: #D1FAE5; border-color: #34D399; color: #065F46; opacity: 0.5; }

        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .audio-btn { background: none; border: none; cursor: pointer; font-size: 1.4rem; vertical-align: middle; margin-left: 10px; }
        
        .regen-btn-small { position: absolute; top: 10px; left: 10px; background: transparent; border: none; font-size: 1.2rem; cursor: pointer; color: #9ca3af; }
        .regen-btn-small:hover { color: var(--primary); }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>üá∫üá∏ English Master AI</h1>
        </header>

        <div class="search-bar-container">
            <input type="text" id="manualSearchInput" class="search-input" placeholder="üîç Type an English word...">
            <button class="search-btn" onclick="searchManualWord()">Go</button>
        </div>

        <div class="controls" id="configPanel">
            <div class="form-row">
                <div class="form-group" style="flex: 0 0 80px;">
                    <label>Letter</label>
                    <select id="letterSelect" onchange="updateSubCategories()"></select>
                </div>
                
                <div class="form-group">
                    <label>Word Groups (Select one or more)</label>
                    <div id="subCatsArea" class="sub-cats-container">
                        <div style="color: #999; padding:10px; font-size:0.8rem;">Select a letter first.</div>
                    </div>
                </div>
            </div>
            <button class="main-btn" onclick="startSession()" id="genBtn">Start Practice</button>
        </div>

        <div id="practice-area">
            <div class="progress-container">
                <div class="progress-track">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText">0 left</div>
            </div>

            <div id="active-card-container" style="width: 100%; display:flex; justify-content:center;"></div>
            
            <button onclick="resetSession()" style="margin-top:20px; background:none; border:none; text-decoration:underline; color:#666; cursor:pointer;">Choose another list</button>
        </div>
    </div>

    <div class="word-bank-container">
        <div class="word-bank-title">Words remaining in queue:</div>
        <div class="word-chips" id="wordBank">
            <span style="font-size:0.8rem; color:#999;">No active session.</span>
        </div>
    </div>

<script>
    const API_KEY = "AIzaSyDSLNaSH4dIT0ZfqmabqCPge1FqbXstcZA"; 
    
    let appState = {
        exercises: [],
        queue: [], 
        completedIndices: new Set()
    };

    // Fonction STT (Speech to Text)
    function startDictation() {
        if (window.SpeechRecognition || window.webkitSpeechRecognition) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = "en-US";

            const micBtn = document.getElementById('micBtn');
            const input = document.getElementById('userInput');
            const originalPlaceholder = input.placeholder;

            recognition.onstart = function() {
                micBtn.classList.add('listening');
                input.placeholder = "Listening...";
            };

            recognition.onend = function() {
                micBtn.classList.remove('listening');
                input.placeholder = originalPlaceholder;
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                input.value = transcript;
            };

            recognition.start();
        } else {
            alert("Sorry, voice recognition is not supported in this browser.");
        }
    }

    function speakText(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }
    }

    async function findWorkingModel() {
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${API_KEY}`);
            if (!response.ok) throw new Error("Key check failed");
            const data = await response.json();
            const validModel = data.models.find(m => 
                m.supportedGenerationMethods.includes("generateContent") && 
                (m.name.includes("gemini") || m.name.includes("pro"))
            );
            return validModel ? validModel.name : "models/gemini-pro";
        } catch (e) { 
            return "models/gemini-pro"; 
        }
    }

    async function callGemini(prompt) {
        const modelName = await findWorkingModel();
        const url = `https://generativelanguage.googleapis.com/v1beta/${modelName}:generateContent?key=${API_KEY}`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });

        if (!response.ok) {
            const errData = await response.json();
            throw new Error(errData.error?.message || "Google API Error");
        }
        
        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
    }

    // --- LISTE DE VOCABULAIRE ---
    const RAW_VOCAB = `
Words ‚Äì A
about
ability
above
able
abandon
abandoned
abroad
absence
absent
absolute
absolutely
absorb
abuse
academic
accent
accept
acceptable
access
accident
accidental
accidentally
accommodation
accompany
according to
account
accurate
accurately
accuse
achieve
achievement
acknowledge
acquire
across
act
action
active
actively
activity
actor; actress
actual
actually
adapt
addition
additional
address
adequate
adequately
adjust
admire
admit
adopt
adult
advance
advanced
advantage
adventure
advertise
advertisement
advertising
advice
advise
affair
affection
afford
afraid
after
afternoon
afterwards
again
against
age
agency
aggressive
ago
agree
agreement
ahead
aim
airport
alarm
alarming
alcohol
alcoholic
alive
all right
allow
ally
almost
alone
along
aloud
alphabet
alphabetical
alphabetically
already
alternative
although
altogether
always
amaze
amazing
ambition
ambulance
among(amongst)
amount
amuse
amusing
analyse
analyze
analysis
ancient
anger
angle
angrily
angry
animal
ankle
anniversary
announce
annoy
annoyed
annoying
annual
annually
another
answer
anticipate
anxiety
anxious
anxiously
any
anyone
anybody
anything
anyway
anywhere
apart
apartment
apologize
apparent
apparently
appeal
appear
appearance
apple
application
apply
appoint
appointment
appreciate
approach
appropriate
approval
approve
approving
approximate
approximately
april
area
argue
argument
arise
arm
armed
army
around
arrange
arrangement
arrest
arrival
arrive
arrow
art
article
artificial
artist
artistic
ashamed
aside
ask
asleep
aspect
assist
assistance
assistant
associate
association
assume
assure
atmosphere
attach
attached
attack
attempt
attend
attention
attitude
attorney
attract
attraction
attractive
audience
august
aunt
authority
automatic
automatically
available
average
avoid
awake
award
aware
away
awful
awfully
awkward
awkwardly
Words ‚Äì B
back
background
backwards
bad
bad-tempered
badly
bag
baggage
bake
balance
ball
ban
bandage
bank
bar
bargain
barrier
base
basic
basically
basis
bath
bathroom
battle
bay
beach
bear
beard
beat
beautiful
beautifully
beauty
because
become
bed
bedroom
beef
beer
before
begin
beginning
behalf
behave
behavior
behind
belief
believe
belong
below
belt
bend
benefit
beside
bet
better
best
between
beyond
bicycle
bid
big
bill
biology
bird
birth
birthday
bit
bite
bitter
black
blame
blank
blind
block
blood
blow
blue
boat
body
boil
bone
book
boot
border
bored
boring
born
borrow
boss
both
bother
bottle
bottom
bound
bowl
box
boy
brain
branch
brand
brave
bread
break
breakfast
breast
breath
breathe
breathing
brick
bridge
brief
briefly
bright
brightly
brilliant
bring
broad
broadcast
broadly
brother
brown
brush
bubble
budget
build
building
bunch
burn
burst
bury
bus
bush
business
businessman
businesswoman
busy
but
butter
button
buy
by
bye
Words ‚Äì C
cabinet
cable
cake
calculate
call
calm
calmly
camera
camp
can
cancel
cancer
candidate
candy
capable
capacity
capital
captain
capture
car
card
cardboard
career
careful
carefully
careless
carelessly
carpet
carry
case
cash
castle
catch
cause
ceiling
celebrate
celebration
cellphone
cent
center
century
ceremony
certainly
certificate
chain
chair
chairman
chairwoman
challenge
chance
change
channel
chapter
character
characteristic
charge
charity
chase
chat
cheap
cheat
check
cheek
cheerful
cheerfully
chemical
chemist
chemistry
chest
chew
chicken
chief
child
chin
chocolate
choice
choose
church
cigarette
cinema
circle
circumstance
citizen
city
civil
claim
clap
class
classic
classroom
clean
clear
clearly
clerk
clever
client
climate
climb
climbing
clock
close
closely
closet
clothes
clothing
cloud
coach
coat
coffee
coin
cold
collapse
colleague
collect
collection
college
color
combination
combine
come
comedy
comfort
comfortable
command
comment
commission
commit
commitment
committee
common
commonly
communicate
communication
community
company
compare
comparison
compete
competition
competitive
complain
complaint
complete
completely
complex
complicate
complicated
computer
concentrate
concentration
concern
concerned
concert
conclude
conclusion
concrete
condition
conduct
conference
confidence
confident
confine
confirm
conflict
confront
confuse
confused
confusing
confusion
congratulations
congress
connect
connection
consequence
conservative
consider
considerable
considerably
consideration
consist of
constant
constantly
construct
construction
consult
consumer
contact
contain
content
contest
context
continent
continue
continuous
continuously
contract
contrast
contribute
contribution
control
convenient
convention
conventional
conversation
convert
convince
cook
cooker
cookie
cooking
cool
cope
core
corner
correct
cost
cottage
cough
could
count
counter
country
countryside
couple
courage
course
court
cousin
cover
cow
crack
crash
crazy
cream
create
creature
credit
crime
crisis
critical
criticism
criticize
crop
cross
crowd
crowded
crown
crucial
cruel
crush
cry
cultural
culture
cup
cupboard
cure
curious
curl
curly
current
currently
curtain
curve
custom
customer
cut
cycle
Words ‚Äì D
dad
daily
damage
damp
dance
dancer
danger
dangerous
dare
dark
data
date
daughter
day
dead
deaf
deal
dear
death
debate
debt
decade
decay
december
decide
decision
declare
decline
decorate
decoration
decrease
deep
deeply
defeat
defend
define
definite
definitely
definition
degree
delay
deliberate
deliberately
delicate
delight
deliver
delivery
demand
demonstrate
dentist
deny
department
departure
depend
deposit
depress
depressed
depth
describe
description
desert
deserted
deserve
design
desire
desk
desperate
desperately
despite
destroy
destruction
detail
detailed
determination
determine
determined
develop
development
device
devote
devoted
diagram
diamond
diary
dictionary
die
diet
difference
different
differently
difficult
difficulty
dig
dinner
direct
direction
directly
director
dirt
dirty
disadvantage
disagree
disappear
disappoint
disappointed
disappointment
disapproval
disapprove
disaster
discipline
discount
discover
discovery
discuss
discussion
disease
disgust
disgusting
dish
dishonest
dislike
dismiss
dissolve
distance
distinguish
distribute
district
disturb
divide
divorce
do
doctor
document
dog
dollar
domestic
dominate
door
dot
double
doubt
down
downstairs
dozen
draft
drag
dramatic
dramatically
draw
drawing
dream
dress
drink
drive
driver
driving
drop
drug
drum
drunk
dry
due
dull
during
dust
duty
Words ‚Äì E
each
ear
early
earn
earth
ease
easily
east
eastern
easy
economic
economy
edge
edition
educate
education
effect
effective
effectively
efficient
efficiently
effort
egg
either
elbow
elderly
elect
election
electric
electrical
electronic
elegant
elevator
else
elsewhere
embarrass
embarrassed
embarrassing
embarrassment
emerge
emergency
emotion
emotional
emphasis
emphasize
employ
employee
employer
employment
empty
enable
encounter
encourage
encouragement
end
ending
enemy
energy
engaged
engine
engineer
engineering
enjoy
enjoyable
enormous
enough
ensure
enter
entertain
entertaining
entertainment
enthusiasm
enthusiastic
entire
entirely
entitle
entrance
entry
envelope
environment
environmental
equal
equally
equipment
equivalent
error
escape
especially
essay
essential
essentially
establish
estate
estimate
etc
euro
even
evening
event
eventually
ever
every
everyone
everything
everywhere
evidence
evil
exact
exactly
exaggerate
exam
examine
example
excellent
except
exception
exchange
excited
excitement
exciting
exclude
excuse
executive
exercise
exhibit
exhibition
exist
existence
exit
expand
expect
expectation
expense
expensive
experience
experiment
expert
explain
explanation
explode
explore
explosion
export
expose
express
expression
extend
extensive
extent
extra
extraordinary
extreme
extremely
eye
Words ‚Äì F
face
facility
fact
factor
factory
fail
failure
fair
fairly
faith
faithful
fall
fame
familiar
family
famous
fan
far
farm
farmer
farming
fashion
fashionable
fast
fasten
fat
father
fault
favor
favorite
fear
feature
february
fee
feed
feel
feeling
female
fence
festival
fever
few
field
fight
figure
fill
film
final
finally
finance
financial
find
fine
finger
finish
fire
firm
firmly
first
fish
fit
fix
flag
flame
flash
flat
flavor
flight
float
flood
floor
flour
flow
flower
flu
fly
focus
fold
follow
following
food
foot
football
for
force
forecast
foreign
forest
forever
forget
forgive
fork
form
formal
formally
former
formula
fortune
forward
foundation
frame
free
freedom
freeze
frequent
frequently
fresh
friday
fridge
friend
friendly
friendship
frighten
frightened
frightening
from
front
fruit
fry
fuel
full
fully
fun
function
fund
fundamental
funeral
funny
furniture
further
future
Words ‚Äì G
gain
gamble
gap
garage
garbage
garden
gas
gasoline
gate
gather
general
generally
generate
generation
generous
generously
gentle
gentleman
gently
genuine
genuinely
geography
get
giant
gift
girl
girlfriend
give
glad
glass
glasses
global
glove
glue
go
goal
god
gold
good
goodbye
goods
government
grab
grade
gradual
gradually
grammar
grand
grandchild
grandfather
grandmother
grandparents
grass
grateful
grave
gray
great
greatly
green
groceries
grocery
ground
group
grow
growth
guarantee
guard
guess
guest
guide
guilty
guy
Words ‚Äì H
habit
hair
hairdresser
half
hall
hammer
hand
handle
hang
happen
happily
happiness
happy
hard
hardly
harm
harmful
harmless
hat
hate
hatred
have
he
head
headache
heal
health
healthy
hear
heart
heat
heaven
heavily
heavy
heel
height
hell
hello
help
helpful
her
here
hero
hers
herself
hesitate
hi
hide
high
highly
highway
hill
him
himself
hip
hire
his
historical
history
hit
hobby
hold
hole
holiday
hollow
home
homework
honest
honestly
honor
hook
hope
horn
horror
horse
hospital
host
hot
hotel
hour
house
household
how
however
huge
human
humor
humorous
hungry
hunt
hunting
hurry
hurt
husband
Words ‚Äì I
ice
ice cream
idea
ideal
ideally
identify
identity
ignore
ill
illegal
illness
illustrate
image
imaginary
imagination
imagine
immediate
immediately
impact
impatient
impatiently
imply
import
importance
important
importantly
impose
impossible
impress
impression
impressive
improve
improvement
in
inability
incident
include
including
income
increase
indeed
independence
independent
indicate
indirectly
individual
indoor
indoors
industrial
industry
inevitable
inevitably
infect
infection
infectious
influence
inform
informal
information
ingredient
initial
initially
injure
injury
ink
inner
innocent
insect
insert
inside
insist
install
instance
instead
institute
instruction
instrument
insult
insurance
intelligence
intelligent
intend
intention
interest
interested
interesting
interior
internal
international
interpret
interpretation
interrupt
interruption
interval
interview
into
introduce
introduction
invent
invention
invest
investigate
investigation
investment
invitation
invite
involve
iron
irritate
irritated
irritating
island
issue
it
item
its
itself
Words ‚Äì J
jacket
jam
january
jealous
jewellery
job
join
joint
joke
journalist
journey
joy
judge
judgement
juice
july
jump
june
junior
just
justify
Words ‚Äì K
keen
keep
key
keyboard
kick
kid
kill
kilogram
kilometer
kind
kindly
kindness
king
kiss
kitchen
knee
knife
knit
knitting
knock
know
knowledge
Words ‚Äì L
labor
laboratory
lack
lady
lake
lamp
land
language
large
last
late
later
later
latter
laugh
launch
law
lawyer
lay
lazy
lead
leader
leading
leaf
lean
learn
least
leather
leave
lecture
leg
legal
lemon
lend
length
less
lesson
let
letter
level
library
license
lid
lie
life
lift
light
lightly
like
likely
limit
limited
line
lip
liquid
list
listen
liter
literature
little
live
living
loan
local
locate
location
lock
lonely
long
look
look after
loose
lose
loss
lot
loud
loudly
love
lovely
lover
low
loyal
luck
lucky
luggage
lunch
lung
Words ‚Äì M
machine
mad
magazine
magic
main
maintain
major
majority
make
male
mall
man
manage
management
manager
manner
manufacture
manufacturer
many
map
mark
market
marketing
marriage
married
marry
massive
master
match
mate
material
mathematics
maths
matter
maximum
may
maybe
mayor
me
meal
mean
meaning
meanwhile
measure
measurement
meat
media
medical
medicine
medium
meet
meeting
melt
member
membership
memory
mental
mentally
mention
menu
mere
merely
mess
message
metal
meter
method
mid-
middle
midnight
might
mild
mile
military
milk
mind
mine
mineral
minimum
minister
ministry
minor
minute
mirror
miss
missing
mistake
mistaken
mix
mixed
mixture
model
modern
moment
monday
money
monitor
month
mood
moon
moral
morally
more
morning
most
mostly
mother
motion
motorcycle
mount
mountain
mouse
mouth
move
movie
Mr.
Mrs.
much
mud
multiply
murder
muscle
museum
music
musical
musician
must
my
myself
mysterious
mystery
Words ‚Äì N
nail
naked
name
narrow
nation
national
natural
naturally
nature
navy
near
nearby
nearly
neat
neatly
necessarily
necessary
neck
need
needle
negative
neighbor
neighborhood
neither
nephew
nervous
nervously
nest
net
never
nevertheless
new
newly
news
newspaper
next
nice
nicely
niece
night
no
nobody
noise
noisy
none
nonsense
nor
normal
normally
north
northern
nose
not
note
nothing
notice
noticeable
novel
november
now
nowhere
nuclear
number
nurse
Words ‚Äì O
o'clock
object
objective
observation
observe
obtain
obvious
obviously
occasion
occasionally
occupied
occur
ocean
october
odd
oddly
of
off
offence
offend
offensive
offer
office
officer
official
officially
often
oil
ok
old
old-fashioned
once
onion
only
onto
open
opening
openly
operate
opinion
opponent
opportunity
oppose
opposite
opposition
option
orange
order
ordinary
organization
organize
organized
origin
original
originally
other
otherwise
our
ours
ourselves
out
outdoor
outdoors
outer
outline
outside
outstanding
oven
over
overall
overcome
owe
own
owner
Words ‚Äì P
p.m
pack
package
packaging
page
pain
painful
paint
painting
pair
palace
pale
pan
pants
paper
parallel
parent
park
part
particular
particularly
partly
partner
partnership
party
pass
passenger
passport
past
path
patience
patient
pause
pay
payment
peace
peaceful
peak
pen
pencil
penny
pension
people
pepper
per
percent
perfect
perfectly
perform
performance
perhaps
period
permanent
permanently
permission
permit
person
personal
personality
personally
persuade
pet
phase
philosophy
photocopy
photograph
photographer
phrase
physical
physically
physics
pick
picture
piece
pile
pill
pilot
pin
pink
pity
place
plain
plan
plane
planet
plant
plastic
plate
play
player
pleasant
pleasantly
please
pleased
pleasure
plenty
plus
pocket
poem
poetry
point
poison
poisonous
pole
police
policy
polish
polite
politely
political
politically
politician
politics
pollution
pool
poor
popular
population
port
position
positive
possess
possession
possibility
possible
post office
pot
potato
potential
pour
powder
power
powerful
practical
practice
praise
prayer
precise
predict
prefer
preference
pregnant
preparation
prepare
presence
present
presentation
preserve
president
press
pressure
pretend
pretty
prevent
previous
previously
price
pride
primarily
primary
prime minister
prince
princess
principle
print
printer
prior
priority
prison
prisoner
private
privately
prize
probable
probably
problem
procedure
proceed
process
produce
producer
product
production
profession
professional
professor
profit
program
progress
project
promise
promote
promotion
prompt
pronounce
pronunciation
proof
proper
properly
property
proportion
proposal
propose
prospect
protect
protection
protest
proud
proudly
prove
provide
pub
public
publication
publicly
publish
publishing
pull
punch
punish
punishment
pupil
purchase
pure
purple
purpose
pursue
push
put
Words ‚Äì Q
qualification
qualified
quality
quantity
quarter
queen
question
quick
quickly
quiet
quietly
quit
quite
quote
Words ‚Äì R
race
racing
radio
rail
railway
rain
raise
range
rapid
rapidly
rare
rarely
rate
rather
raw
reach
react
reaction
read
reader
reading
ready
real
realistic
reality
realize
really
rear
reason
reasonable
recall
receipt
receive
recent
recently
reception
recognition
recognize
recommend
record
recover
red
reduce
reduction
refer
reflect
reform
refrigerator
refusal
refuse
regard
regarding
region
regional
register
regret
regular
regularly
regulation
reject
relate
related
relation
relationship
relative
relatively
relax
relaxed
relaxing
release
relevant
relief
religion
religious
rely
remain
remaining
remark
remarkable
remarkably
remember
remind
remote
remove
rent
repair
repeat
repeated
repeatedly
replace
reply
report
represent
representative
reputation
request
require
requirement
rescue
research
reservation
reserve
resident
resist
resolve
resort
resource
respect
respond
response
responsibility
responsible
rest
restaurant
restore
restrict
restriction
result
retain
retire
retired
retirement
return
reveal
reverse
review
revise
revision
revolution
reward
rhythm
rich
ride
ridiculous
right
ring
rise
risk
rival
river
rob
rock
role
roll
romantic
roof
room
root
rope
rough
roughly
round
route
routine
royal
rubber
rubbish
rude
rudely
ruin
rule
ruler
rumor
run
running
rural
rush
Words ‚Äì S
sack
sad
sadly
safe
safely
safety
sail
sailing
sailor
salad
salary
sale
salt
same
sample
sand
satisfaction
satisfied
satisfy
saturday
sauce
save
say
scale
scare
scared
scene
schedule
school
science
scientific
scientist
scissors
score
scratch
scream
screen
screw
sea
seal
search
season
seat
second
secondary
secret
secretary
secretly
section
secure
security
see
seed
seek
seem
select
selection
sell
send
senior
sense
sensible
sensitive
sentence
separate
separated
separately
separation
september
series
serious
seriously
servant
serve
service
session
set
settle
several
severe
severely
sew
sewing
sex
sexual
shade
shadow
shake
shallow
shame
shape
shaped
share
sharp
shave
she
sheep
sheet
shelf
shell
shine
shiny
ship
shirt
shock
shocked
shocking
shoe
shoot
shop
shopping
short
shortly
should
shoulder
shout
show
shower
shut
shy
sick
side
sight
sign
signal
signature
significant
significantly
silence
silent
silly
silver
similar
simple
simply
since
sincere
sincerely
sing
singer
singing
single
sink
Sir
sister
sit
situation
size
skill
skilled
skin
skirt
sky
sleep
sleeve
slice
slight
slightly
slip
slope
slow
slowly
small
smart
smell
smile
smoke
smoking
smooth
smoothly
snake
snow
so
soap
social
society
sock
soft
software
soil
soldier
solid
solution
solve
some
somebody someone
somehow
something
sometimes
somewhat
somewhere
son
song
soon
sore
sorry
sort
soul
sound
soup
sour
source
south
southern
space
spare
speak
speaker
special
specialist
specially
specific
specifically
speech
speed
spell
spend
spice
spicy
spider
spin
spirit
spiritual
spite
split
spoil
spoon
sport
spread
spring
stable
staff
stage
stair
stamp
stand
standard
star
stare
start
state
statement
station
statue
status
stay
steadily
steady
steal
steam
steel
steep
step
stick
sticky
stiff
still
sting
stir
stock
stomach
stone
stop
store
storm
story
stove
straight
strange
strangely
stranger
strategy
stream
street
strength
stress
stressed
stretch
strict
strictly
strike
string
strong
strongly
struggle
student
studio
study
stuff
stupid
style
subject
substantial
substantially
substitute
succeed
success
successful
successfully
such
suck
sudden
suddenly
suffer
suffering
sufficient
sufficiently
sugar
suggest
suggestion
suit
suitable
suitcase
suited
sum
summary
summer
sun
sunday
superior
supermarket
supply
support
suppose
sure
surely
surface
surprise
surprised
surprising
surprisingly
surround
surrounding
survey
survive
suspect
suspicious
swallow
swear
sweat
sweater
sweep
sweet
swim
swimming
switch
swollen
symbol
sympathy
system
Words ‚Äì T
table
tablet
tackle
take
take off
talk
tall
tank
target
task
taste
tax
taxi
tea
teach
teacher
teaching
team
tear
technical
technique
technology
television
tell
temperature
temporarily
temporary
tend
tendency
tension
tent
term
terrible
terribly
test
text
than
thank
thanks
that
theater
their
theirs
them
theme
themselves
then
theory
there
therefore
they
thick
thickness
thief
thin
thing
think
thinking
thirsty
this
thorough
thoroughly
though
thought
thread
threat
threaten
threatening
throat
through
throughout
throw
thumb
thursday
ticket
tidy
tie
tight
tightly
till
time
timetable
tin
tiny
tip
tire
tired
tiring
title
to
today
toe
together
toilet
tomato
tomorrow
ton
tone
tongue
tonight
too
tool
tooth
top
topic
total
totally
touch
tough
tour
tourist
towards
towel
tower
town
toy
trace
track
trade
trading
tradition
traditional
traffic
train
training
transfer
transform
translate
translation
transparent
transport
trap
travel
traveller
treat
treatment
tree
trend
trial
triangle
trick
trip
tropical
trouble
truck
truly
trust
truth
try
tube
tuesday
tune
tunnel
turn
twice
twin
twist
type
typical
Words ‚Äì U
ugly
ultimate
ultimately
umbrella
unable
unacceptable
uncertain
uncle
uncomfortable
unconscious
under
underneath
understand
understanding
underwear
undo
unemployed
unemployment
unexpected
unexpectedly
unfair
unfairly
unfortunate
unfortunately
unfriendly
unhappiness
unhappy
uniform
unimportant
unique
universe
university
unkind
unknown
unless
unlike
unlikely
unlucky
unnecessary
unpleasant
unreasonable
unsteady
unsuccessful
untidy
until
unusual
unwilling
up
upon
upper
upset
upside down
upstairs
urban
urge
urgent
us
use
useful
useless
usual
usually
Words ‚Äì V
vacation
valid
valley
valuable
value
variety
various
vary
vast
vegetable
vehicle
version
vertical
very
victim
victory
video
view
village
violence
violent
violently
virtually
virus
visible
vision
visit
visitor
vital
vocabulary
voice
volume
vote
Words ‚Äì W
wage
waist
wait
waiter
waitress
wake
walk
wall
wallet
wander
want
war
warm
warmth
warn
warning
wash
washing
waste
watch
water
wave
way
weak
weakness
wealth
weapon
wear
weather
wedding
wednesday
week
weekend
weekly
weigh
weight
welcome
well
well-known
west
western
wet
what
whatever
wheel
when
whenever
where
wherever
whether
which
while
whisper
whistle
white
who
whoever
whole
whose
why
wide
widely
width
wife
wild
will
willing
willingly
willingness
win
wind
window
wine
wing
winner
winning
winter
wise
wish
with
withdraw
within
without
witness
woman
wonder
wonderful
wood
wooden
word
work
worker
working
world
worried
worry
worth
would
wrap
wrist
write
writer
writing
wrong
wrongly
Words ‚Äì Y & Z
yawn
year
yellow
yes
yesterday
yet
you
young
your
yours
yourself
youth
zone
`;

    const vocabulary = {};
    const WORDS_PER_GROUP = 25; 

    function parseVocabulary() {
        let currentLetter = '';
        const lines = RAW_VOCAB.split('\n');

        lines.forEach(line => {
            line = line.trim();
            if (!line) return;

            if (line.toLowerCase().startsWith('words ‚Äì') || line.toLowerCase().startsWith('words -')) {
                currentLetter = line.split(/[‚Äì-]/)[1].trim().toUpperCase();
                if (!vocabulary[currentLetter]) vocabulary[currentLetter] = [];
            } else if (currentLetter) {
                vocabulary[currentLetter].push(line);
            }
        });
    }

    parseVocabulary();

    const letterSelect = document.getElementById('letterSelect');
    Object.keys(vocabulary).sort().forEach(l => {
        let opt = document.createElement('option');
        opt.value = l; opt.innerText = l;
        letterSelect.appendChild(opt);
    });

    function updateSubCategories() {
        const letter = letterSelect.value;
        const container = document.getElementById('subCatsArea');
        container.innerHTML = '';
        if (!letter || !vocabulary[letter]) return;

        const words = vocabulary[letter];

        for (let i = 0; i < words.length; i += WORDS_PER_GROUP) {
            const rangeValue = `${i}-${i + WORDS_PER_GROUP}`;
            const groupNum = Math.floor(i / WORDS_PER_GROUP) + 1;
            
            const div = document.createElement('div');
            div.innerHTML = `
                <input type="checkbox" id="grp-${i}" class="cat-checkbox" name="subcat" value="${rangeValue}">
                <label for="grp-${i}" class="cat-label" title="${words[i]} ... ${words[Math.min(i+WORDS_PER_GROUP-1, words.length-1)]}">
                    ${groupNum}
                </label>
            `;
            container.appendChild(div);
        }
    }
    
    // Initial call
    if(letterSelect.options.length > 0) {
        letterSelect.value = letterSelect.options[0].value;
        updateSubCategories();
    }

    async function startSession() {
        const letter = letterSelect.value;
        const checkboxes = document.querySelectorAll('input[name="subcat"]:checked');
        
        if (!letter || checkboxes.length === 0) {
            alert("Please select at least one word group.");
            return;
        }

        let pool = [];
        const allWords = vocabulary[letter];
        checkboxes.forEach(cb => {
            const [start, end] = cb.value.split('-').map(Number);
            pool = pool.concat(allWords.slice(start, end));
        });

        if (pool.length > 40) {
            if(!confirm(`You selected ${pool.length} words. This might take a moment. Continue?`)) return;
        }

        await generateData(pool);
    }

    async function searchManualWord() {
        const input = document.getElementById('manualSearchInput');
        const word = input.value.trim();
        if(!word) return;

        const btn = document.querySelector('.search-btn');
        const originalText = btn.innerText;
        btn.innerText = "‚è≥";
        btn.disabled = true;

        await generateData([word], true); 
        
        input.value = '';
        btn.innerText = originalText;
        btn.disabled = false;
    }

    async function generateData(wordList, isSearch = false) {
        const genBtn = document.getElementById('genBtn');
        genBtn.innerHTML = '<span class="spinner"></span> Generating...';
        genBtn.disabled = true;

        const prompt = `
            ROLE: English Teacher for Arabic speakers.
            TASK: Create sentences for EACH word in this list: ${JSON.stringify(wordList)}.
            IMPORTANT:
            1. Arabic sentences must be SHORT, SIMPLE (A1 Level), Daily Life context.
            2. JSON Array output ONLY.
            OUTPUT FORMAT:
            [
                { "arabic": "...", "target_word": "...", "english_translation": "..." }
            ]
        `;

        try {
            const raw = await callGemini(prompt);
            const cleanJson = raw.replace(/```json/g, '').replace(/```/g, '').trim();
            const newData = JSON.parse(cleanJson);

            appState.exercises = newData;
            appState.queue = newData.map((_, index) => index); 
            appState.completedIndices = new Set();

            document.getElementById('configPanel').classList.add('hidden');
            document.getElementById('practice-area').style.display = 'flex';
            
            updateUI();

        } catch (e) {
            console.error(e);
            alert("Generation Error. Check connection.");
        } finally {
            genBtn.innerHTML = 'Start Practice';
            genBtn.disabled = false;
        }
    }

    function updateUI() {
        renderCard();
        updateControls();
        renderFooterWordBank();
    }

    function renderCard() {
        const container = document.getElementById('active-card-container');
        
        if (appState.queue.length === 0) {
            container.innerHTML = `
                <div class="card" style="text-align:center; padding:50px;">
                    <h2 style="color:var(--accent);">üéâ Session Complete! üéâ</h2>
                    <p>You have mastered all words in this session.</p>
                    <button class="main-btn" onclick="resetSession()">Start New Session</button>
                </div>
            `;
            return;
        }

        const currentIndex = appState.queue[0];
        const data = appState.exercises[currentIndex];
        
        container.innerHTML = `
            <div class="card">
                <button class="regen-btn-small" onclick="regenerateCurrent()" title="New sentence">‚Üª</button>
                <div class="arabic-phrase">${data.arabic}</div>
                
                <div style="margin-bottom:10px; color:#555;">
                    Target word : <strong style="color:var(--primary); font-size:1.2rem;">${data.target_word}</strong>
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" class="translation-input" id="userInput" placeholder="Type or speak (English)..." onkeydown="if(event.key==='Enter') checkAnswer()">
                        <button class="mic-btn" id="micBtn" onclick="startDictation()" title="Speak">üé§</button>
                    </div>
                    <button class="action-btn check-btn" id="checkBtn" onclick="checkAnswer()">Check</button>
                </div>
                
                <div class="feedback-box" id="feedbackBox"></div>

                <div class="eval-buttons" id="evalButtons">
                    <button class="btn-correct" onclick="handleResult(true)">‚úÖ Correct (Next)</button>
                    <button class="btn-incorrect" onclick="handleResult(false)">‚ùå Incorrect (Repeat later)</button>
                </div>
            </div>
        `;
    }

    function updateControls() {
        const total = appState.exercises.length;
        const remaining = appState.queue.length;
        const completed = total - remaining;
        const pct = (completed / total) * 100;
        
        document.getElementById('progressBar').style.width = `${pct}%`;
        document.getElementById('progressText').innerText = `${remaining} left`;
    }

    function renderFooterWordBank() {
        const bank = document.getElementById('wordBank');
        bank.innerHTML = '';

        appState.exercises.forEach((ex, idx) => {
            const chip = document.createElement('span');
            chip.className = 'word-chip';
            
            if (appState.completedIndices.has(idx)) {
                chip.classList.add('completed');
            } 
            else if (appState.queue.length > 0 && idx === appState.queue[0]) {
                chip.classList.add('active');
            }
            
            chip.innerText = ex.target_word;
            bank.appendChild(chip);
        });
    }

    function resetSession() {
        document.getElementById('configPanel').classList.remove('hidden');
        document.getElementById('practice-area').style.display = 'none';
        appState.exercises = [];
        appState.queue = [];
        document.getElementById('wordBank').innerHTML = '<span style="font-size:0.8rem; color:#999;">No active session.</span>';
    }

    async function checkAnswer() {
        const input = document.getElementById('userInput');
        const checkBtn = document.getElementById('checkBtn');
        const feedback = document.getElementById('feedbackBox');
        const evalButtons = document.getElementById('evalButtons');
        
        const currentIndex = appState.queue[0];
        const currentData = appState.exercises[currentIndex];
        
        const userText = input.value.trim();
        const correctText = currentData.english_translation;
        const safeCorrect = correctText.replace(/'/g, "\\'");

        const audioBtn = `<button class="audio-btn" onclick="speakText('${safeCorrect}')">üîä</button>`;

        feedback.style.display = 'block';

        if (!userText) {
            feedback.className = 'feedback-box';
            feedback.style.background = '#EFF6FF';
            feedback.style.color = '#1D4ED8';
            feedback.style.border = '1px solid #BFDBFE';
            feedback.innerHTML = `<strong>Answer:</strong> ${correctText} ${audioBtn}`;
            input.disabled = true;
            checkBtn.style.display = 'none';
            evalButtons.style.display = 'flex';
            return;
        }

        feedback.innerHTML = '<span class="spinner"></span> Checking...';
        
        const prompt = `
            TASK: Evaluate English translation.
            Original (Arabic): "${currentData.arabic}"
            Target Word: "${currentData.target_word}"
            User Input: "${userText}"
            Correct Answer: "${correctText}"
            RULES: If user uses the target word correctly and meaning is close, mark CORRECT.
            OUTPUT JSON: { "is_correct": boolean, "message": "Short feedback in English" }
        `;

        try {
            const raw = await callGemini(prompt);
            const res = JSON.parse(raw.replace(/```json/g, '').replace(/```/g, '').trim());

            if (res.is_correct) {
                feedback.className = 'feedback-box success';
                feedback.innerHTML = `<strong>Correct!</strong> ${res.message} ${audioBtn}`;
            } else {
                feedback.className = 'feedback-box error';
                feedback.innerHTML = `<strong>Not quite.</strong> ${res.message}<br><em>Answer: ${correctText}</em> ${audioBtn}`;
            }

            input.disabled = true;
            checkBtn.style.display = 'none';
            evalButtons.style.display = 'flex';

        } catch (e) {
            feedback.innerText = "Connection Error.";
            input.disabled = true;
            checkBtn.style.display = 'none';
            evalButtons.style.display = 'flex';
        }
    }

    function handleResult(isCorrect) {
        const currentIndex = appState.queue.shift(); 

        if (isCorrect) {
            appState.completedIndices.add(currentIndex);
        } else {
            appState.queue.push(currentIndex);
        }

        updateUI(); 
    }

    async function regenerateCurrent() {
        if(appState.queue.length === 0) return;
        const currentIndex = appState.queue[0];
        const currentData = appState.exercises[currentIndex];
        
        const btn = document.querySelector('.regen-btn-small');
        btn.innerHTML = '<span class="spinner"></span>';

        const prompt = `
            ROLE: English Teacher.
            TASK: Create 1 NEW Simple Sentence (Level A1) using word: "${currentData.target_word}".
            Different from: "${currentData.english_translation}".
            OUTPUT JSON: [{"arabic": "...", "target_word": "${currentData.target_word}", "english_translation": "..."}]
        `;

        try {
            const raw = await callGemini(prompt);
            const newData = JSON.parse(raw.replace(/```json/g, '').replace(/```/g, '').trim())[0];
            
            appState.exercises[currentIndex] = newData;
            updateUI(); 
        } catch(e) {
            alert("Regeneration Error");
            btn.innerHTML = '‚Üª';
        }
    }
</script>
</body>
</html>